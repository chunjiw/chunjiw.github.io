@def title = "我的私有服务器配置方案概述"
@def date = Date(2021, 9, 5)


\toc

---


经过差不多一年半的折腾，目前我的私有服务器配置大致成型，基本没出过大问题，是时候写个概述了。

## 硬件

- 4 x 树莓派 (Raspberry Pi 3 or 4) 
- 3 x 硬盘

WiFi 和 Ethernet 相信大家至少会有一个，不必单独列出来了。

其中四个树莓派其实大可不必，我目前的配置，两个到三个完全够用，用多个纯是因为方便。

## 应用

- 智能家居 [Home Assistant](https://www.home-assistant.io/)
- 云笔记 - [TiddlyWiki](https://tiddlywiki.com/)
- 云存储 - [Seafile](https://www.seafile.com)
- 云媒体 - [Emby](https://emby.media/) / [Jellyfin](https://jellyfin.org/)
- 云相册 - [Photoprism](https://photoprism.app/)
- 云日历和电话簿 - [Baikal](https://github.com/sabre-io/Baikal/) + [DAVx~~~<sup>5</sup>~~~](https://www.davx5.com/)

### 智能家居 - Home Assistant

我用的是开源智能家居管理系统 Home Assistant OS。
Home Assistant 有软件版本和操作系统版本，我尝试了软件版本，发现功能不全，考虑到这个应用与其他应用不参合，就用了操作系统版本，安装在一个树莓派4上。

我在家里几乎每扇窗上，和一些门上装了门窗传感器，实现的功能包括

- 推送通知，如果院子或车库的门被打开
- 推送通知，如果睡前或离开家的时候忘记关上重要门窗

在一些开关中安装智能开关，使得我可以

- 用手机查看开关状态，或者开关灯
- 睡前自动关闭热水器，起床自动打开热水器

在一些房间中安装了运动传感器，使得

- 检测到运动后自动开灯

其中细节应另做文章细述。


### 云笔记 - TiddlyWiki

这是我最依赖的应用。
当初开始玩私有服务器，也是因为对这个应用的强烈需求。

我用的是 TiddlyWiki，很奇怪的一个名字，它的特点是小巧却很多功能，有很多插件可以安装，安装过程十分简单。
最近需要使用任务管理工具，正好发现一个插件叫做 Projectify，一秒钟安装使用，爽歪歪。
缺点是没有专门的手机 App，不过可以用手机浏览器直接访问，也算方便吧。

从去年 4 月开始到现在，积累了 3 MB 的笔记；这些笔记及其重要，绝对不能丢失，所以我设置了一个 cron job，每日自动备份到一个 git repo，确保万无一失。



### 云存储 - Seafile

试验很多方案后决定使用 Seafile。

说来有趣，Seafile 是北京海文互知的产品，已发展为国际化的开源项目。
这本身就是一件不易，了不起的事情：产品开源后受到广泛关注，意味着这个项目质量很高。
Seafile 现在好像都没有中文名字了，以前是叫海云云盘吗？我不确定。

Seafile 的优点是快，可靠，对系统的要求低。缺点是安装不是很容易。
在它之前我尝试过 NextCloud，名声比 Seafile 大多了，但是在树莓派上根本就跑不起来，被我抛弃。

### 云媒体 - Emby / Jellyfin

有超多的私有云媒体应用可供选择，我最终选择了两个：Emby 和 Jellyfin。

Jellyfin 其实源于 Emby。Emby 采用 Freemium 模式，有一些功能要付费才能享用。
正是因为如此，一部分 Emby 开发者离开，创建了 Jellyfin，所以 Jellyfin 是完全开源的。

两个都用，是因为 Jellyfin 还没有完全成熟，比如智能电视上没有 App，安卓的 App 很差；
而 Emby 免费版本又有各种限制。

### 云相册 - Photoprism

Photoprism!

去年刚开始的时候到处找私人相册产品，总是没有能满意的。
我在乎的只是简单地把手机上的照片自动传到云相册，然后云相册看起来比较好看，仅此而已。
去年 Photoprism 还在开发中；今年已进入测试阶段，可以用！
我已经把十多年的照片导入其中，看上去很漂亮。

为了把手机上的照片自动上传，我用 [Syncthing](https://syncthing.net/) 把照片同步到服务器。
其中涉及到照片的批处理和自动导入，应另做文章细述。

Photoprism 作为谷歌相册的替代品，已经很令我满意了。

### 云日历和电话簿 - Baikal

这两个东西简单却重要。我用的是 Baikal；在安卓手机上需要用一个叫做 DAVx~~~<sup>5</sup>~~~ 的 App 完成同步。

缺点是没有网络客户端，所以只能通过手机 App 或电脑程序来使用。

## 感受

有时候会问自己，花好长时间做这些东西真的值得吗？
毕竟每一个应用都可以用市场上已有的免费产品。
但是换个角度讲，无论什么事情都可不做，那么难道如此就什么都不做么？
既然我从中获得乐趣，也就坦然乐此不疲吧。

实际的好处也多多，再也不用受到他人的限制，比如 Evernote 限制最多两个客户端，谷歌照片限制分辨率和存储空间，都是我不用考虑的问题。
同时学到一些操作系统管理技能，时不时可以在工作中用到。